# Роутинг

Маршрутизация выполняется с помощью экземпляра класса _Router_, который 
позволяет зарегистрировать допустимые маршруты и обработать вызов.

## Добавление маршрута

Добавление маршрута осуществляется методом _route_, который принимает 
ассоциативный массив, ключами которого являются требуемые для данного маршрута 
опции, а значениями - регулярные выражения, которым должны соответствовать 
значения этих опций.

Естественно опции должны быть верно определены в экземпляре класса _Call_, 
который передается в метод выполнения маршрутизации _run_ этого класса.

Если опция является маркерной (не принимает значения), регулярное выражение 
может определять его как `/^1$/` - если опция должна присутствовать, и как 
`/^$/` - если опции быть не должно.

Обработчиком маршрута может быть:

- Анонимная функция
- Строка, содержащая имя глобальной функции
- Строка содержащая имя метода

В последнем случае необхомо так же передать третий параметр, определяющий 
контекст вызова метода. Этим параметром может быть:

- Объект
- Имя класса, который будет инстанциирован перед вызовом

Пример объявления маршрута:

```php
<?php
use Bricks\Cli\Routing\Router;
use Bricks\Cli\Routing\Call;

$router = new Router;
$router->route(
  [
    'a' => '/^create$/',
    'id' => '/^[0-9]+$/'
  ],
  'method',
  'Controller'
);
$router->run(new Call('a:', ['id:']));
```

Этому маршруту может соответствовать следующий вызов:

```bash
php script -acreate --id="123"
```

## Маршрутизация

Для выполнения маршрутизации используется метод _run_, который принимает 
настроеный экземпляр класса _Call_. Данный метод возвращает те данные, которые 
возвращает использованный обработчик.

В случае, если подходящий обработчик не найден, метод выбрасывает исключение 
_RoutingException_.

Пример обработки исключения:
```php
<?php
use Bricks\Cli\Routing\Router;
use Bricks\Cli\Routing\RoutingException;

$router = new Router;
$router->route(...);
try{
  $router->run(...);
}
catch(RoutingException $e){
    // Обработка.
}
```
